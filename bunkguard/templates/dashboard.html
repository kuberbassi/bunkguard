{% extends "base.html" %}
{% block title %}Dashboard - BunkGuard{% endblock %}
{% block content %}
<div class="page-header">
    <div class="header-text">
        <h1>Welcome back, {{ session.user.given_name }}</h1>
        <p id="systemStatus">SYSTEM STATUS: LOADING...</p>
    </div>
    <div class="page-actions">
        <button id="addNewBtn" class="create-new-btn"><i class='bx bx-plus'></i> Add Subject</button>
    </div>
</div>

<div class="ultimate-dashboard-grid">
    <div class="grid-column">
        <div class="widget attendance-widget">
            <div class="radial-progress" style="--progress: 0;">
                <div class="progress-inner">
                    <div id="progressValue" class="progress-value">0<span>%</span></div>
                    <div class="progress-label">Semester Attendance</div>
                </div>
            </div>
        </div>
        <div class="widget all-time-stats-widget">
            <div class="widget-header">
                <h3><i class='bx bxs-component'></i> All-Time Stats</h3>
            </div>
            <div id="allTimeStats"></div>
        </div>
        <div class="widget recent-activity-widget">
            <div class="widget-header">
                <h3><i class='bx bx-history'></i> Recent Activity</h3><button id="viewAllActivityBtn"
                    class="widget-link">View All</button>
            </div>
            <div id="recentActivityList"></div>
        </div>
    </div>

    <div class="grid-column wide">
        <div class="widget bunk-meter-widget">
            <div class="widget-header">
                <h3><i class='bx bxs-hot'></i> Bunk Meter</h3>
            </div>
            <div id="bunkMeterList"></div>
        </div>
    </div>

    <div class="grid-column">
        <div class="widget deadline-tracker-widget">
            <div class="widget-header">
                <h3><i class='bx bx-task'></i> Deadlines</h3>
            </div>
            <ul id="deadlineList"></ul>
            <button id="addDeadlineBtn" class="create-new-btn"
                style="width: 100%; justify-content: center; margin-top: 15px;">Add Deadline</button>
        </div>
        <div class="widget calendar-widget">
            <div class="calendar-header">
                <button id="prevMonthBtn"><i class='bx bx-chevron-left'></i></button>
                <h3 id="monthYear">Loading...</h3>
                <button id="nextMonthBtn"><i class='bx bx-chevron-right'></i></button>
            </div>
            <div class="calendar-grid" id="calendarGrid"></div>
        </div>
    </div>
</div>

<div id="addModal" class="modal-overlay hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Add New Subject</h2><button id="closeModalBtn" class="close-btn">&times;</button>
        </div>
        <form id="addSubjectForm">
            <div class="form-group"><label for="subjectName">Subject Name</label><input type="text" id="subjectName"
                    required></div>
            <div class="form-group"><label for="subjectSemester">Semester</label><select id="subjectSemester"
                    required>{% for i in range(1, 9) %}<option value="{{ i }}">Semester {{ i }}</option>{% endfor
                    %}</select></div>
            <button type="submit" class="create-new-btn">Add Subject</button>
        </form>
    </div>
</div>

<div id="activityModal" class="modal-overlay hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Full Activity Log</h2><button id="closeActivityModalBtn" class="close-btn">&times;</button>
        </div>
        <div id="fullActivityLog" class="full-activity-log"></div>
    </div>
</div>

<div id="deadlineModal" class="modal-overlay hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Add New Deadline</h2><button id="closeDeadlineModalBtn" class="close-btn">&times;</button>
        </div>
        <form id="addDeadlineForm">
            <div class="form-group"><label for="deadlineTitle">Task / Assignment</label><input type="text"
                    id="deadlineTitle" required></div>
            <div class="form-group"><label for="deadlineDate">Due Date</label><input type="date" id="deadlineDate"
                    required></div>
            <button type="submit" class="create-new-btn">Add Deadline</button>
        </form>
    </div>
</div>
<div id="dailyDetailModal" class="modal-overlay hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="dailyDetailDate"></h2>
            <button id="closeDailyDetailModalBtn" class="close-btn">&times;</button>
        </div>
        <div id="dailyDetailContent">
        </div>
    </div>
</div>
{% endblock %}

{% block body_scripts %}
{# The v=cache_id is important to prevent browser caching issues #}
<script src="{{ url_for('static', filename='script.js', v=cache_id) }}"></script>
{% endblock %}