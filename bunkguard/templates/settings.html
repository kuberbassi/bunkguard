{% extends "base.html" %}
{% block title %}Settings - BunkGuard{% endblock %}

{% block content %}
<div class="page-header">
    <div class="header-text">
        <h1>Settings</h1>
        <p>Manage your subjects, data, and application preferences.</p>
    </div>
</div>

<div class="settings-layout">
    <aside class="settings-sidebar">
        <nav>
            <a href="#subjects" class="sidebar-link active" data-pane="subjects"><i class='bx bxs-book-content'></i><span>Manage Subjects</span></a>
            <a href="#prefs" class="sidebar-link" data-pane="prefs"><i class='bx bxs-tune'></i><span>Preferences</span></a>
            <a href="#leaves" class="sidebar-link" data-pane="leaves"><i class='bx bxs-first-aid'></i><span>Manage Leaves</span></a>
            <a href="#substitutions" class="sidebar-link" data-pane="substitutions"><i class='bx bx-transfer-alt'></i><span>Resolve Substitutions</span></a>
            <a href="#log" class="sidebar-link" data-pane="log"><i class='bx bx-chip'></i><span>System Log</span></a>
            <a href="#data" class="sidebar-link" data-pane="data"><i class='bx bxs-data'></i><span>Data Management</span></a>
        </nav>
    </aside>

    <main class="settings-content">
        <div id="subjects" class="settings-pane active">
            <div class="widget">
                <div class="widget-header"><h3>Subjects for the Selected Semester</h3></div>
                <div id="subjectManagementList" class="subject-management-list"></div>
            </div>
        </div>

        <div id="prefs" class="settings-pane">
            <div class="widget">
                <div class="widget-header"><h3>Application Preferences</h3></div>
                <div class="form-group">
                    <label for="attendanceThreshold">Required Attendance Percentage (%)</label>
                    <input type="number" id="attendanceThreshold" min="1" max="100" value="75">
                    <p class="text-secondary" style="font-size: 0.8rem; margin-top: 8px;">This percentage is used to calculate your "Bunk Meter" status.</p>
                </div>
                <button id="savePrefsBtn" class="create-new-btn">Save Preferences</button>
            </div>
        </div>

        <div id="leaves" class="settings-pane">
            <div class="widget">
                <div class="widget-header"><h3>Pending Medical Leaves</h3></div>
                <div id="pendingLeavesList" class="leaves-management-list"></div>
            </div>
        </div>

        <div id="substitutions" class="settings-pane">
            <div class="widget">
                <div class="widget-header"><h3>Unresolved Substituted Classes</h3></div>
                <p class="text-secondary" style="margin-bottom: 20px;">Select a class that was marked as substituted to assign the correct subject that was taught instead.</p>
                <div id="unresolvedSubstitutionsList"></div>
            </div>
        </div>

        <div id="log" class="settings-pane">
            <div class="widget">
                <div class="widget-header"><h3>System Activity Log</h3></div>
                <div id="systemLogList" class="activity-log-list"></div>
            </div>
        </div>
        
        <div id="data" class="settings-pane">
            <div class="widget">
                <div class="widget-header"><h3>Export & Import Data</h3></div>
                <p class="text-secondary">Save your data or restore it from a previously exported file.</p>
                <a href="/api/export_data" class="create-new-btn" download="bunkguard_data.json"><i class='bx bxs-download'></i> Export All Data</a>
                <hr class="modal-divider" style="margin: 20px 0;">
                <div class="import-controls">
                    <input type="file" id="importFileInput" class="hidden-file-input" accept=".json">
                    <button class="control-btn" onclick="document.getElementById('importFileInput').click();"><i class='bx bxs-file-import'></i> Choose File</button>
                    <span id="fileName" class="file-name">No file selected</span>
                    <button id="importDataBtn" class="create-new-btn" disabled>Import</button>
                </div>
                <div id="importStatus"></div>
            </div>
            <div class="widget danger-zone">
                <div class="widget-header"><h3>Danger Zone</h3></div>
                <p class="text-secondary">This action is irreversible. Please proceed with caution.</p>
                <button id="deleteAllDataBtn" class="control-btn btn-danger"><i class='bx bx-trash'></i> Delete All My Data</button>
            </div>
        </div>
    </main>
</div>

<div id="substitutionModal" class="modal-overlay hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Which class was taken instead?</h2>
            <button id="closeSubstitutionModalBtn" class="close-btn">&times;</button>
        </div>
        <div id="substitutionSubjectList" class="subject-grid">
            </div>
    </div>
</div>
{% endblock %}

{% block body_scripts %}
<script src="{{ url_for('static', filename='settings.js') }}"></script>
{% endblock %}